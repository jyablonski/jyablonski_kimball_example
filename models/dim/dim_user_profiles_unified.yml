version: 2

models:
  - name: dim_user_profiles_unified
    description: User profile resolution model that links related user identities based on email usage patterns
    columns:
      - name: user_id
        description: Original user ID from user actions
        data_tests:
          - unique
          - not_null
      
      - name: resolved_user_id
        description: The canonical user ID this user resolves to (latest in chain)
        data_tests:
          - not_null
          - relationships:
              to: ref('dim_user_profiles_unified')
              field: user_id
      
      - name: identity_count
        description: Number of user_ids linked to this resolved identity
        data_tests:
          - not_null
          - accepted_values:
              values: [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]
              quote: false
      
      - name: resolved_total_actions
        description: Total actions across all linked identities
        data_tests:
          - not_null
          - dbt_utils.expression_is_true:
              expression: ">= total_actions"
